<!DOCTYPE html>
<html><head>

<style media="screen" type="text/css">
    .btnStyle1 { width:60px;}
    .btnStyle2 { width:60px; color: red}
    .btnStyle3 { width:124px; color: blue}
</style>
<script>

var
  edicao=true;
  novo=false;
  Zoom=170;
  Eativo=false;
  Memory="";

/////////////////////////////////////////////////////////////////
//Primitive complex functions
//////////////////////

function EXP(z)
{
  Pi=Math.PI;

  x1=0;
  img1="0";
  x1=z.indexOf("i"); //se nao tem dá -1
  if (x1!=-1) {
     real1=z.substr(0, x1-1);
     img1=z.substr(x1+1,z.length);
  }
  else{
      real1=z;
  }

  sinimg1=Math.sin(parseFloat(img1));
  cosimg1=Math.cos(parseFloat(img1));

  //O que segue é para evitar erros de arredondamento nas funções seno e coseno.
  if (img1==(Pi/2).toString())      //90º
  {
    sinimg1=1.0;
    cosimg1=0.0;
  }
  if (img1==(Pi).toString())      //180º
  {
    sinimg1=0.0;
    cosimg1=-1.0;
  }
  if (img1==(3*Pi/2).toString())   //270º
  {
    sinimg1=-1.0;
    cosimg1=0.0;
  }
  real=(Math.exp(parseFloat(real1))*cosimg1).toString();
  img=(Math.exp(parseFloat(real1))*sinimg1).toString();

  if(img1=="0")
  {
     img="0"; //to avoid small spurious imaginary parts.	  
  }

  if (img!="0") {
     return real+' i'+img;
  }
  else
  {	  
     return real; 
  }
}



function LOG(z)
{
  Pi=Math.PI;
  x1=0;
  img1="0";
  x1=z.indexOf("i"); //se nao tem dá -1
  if (x1!=-1) {
     real1=z.substr(0, x1-1);
     img1=z.substr(x1+1,z.length);
  }
  else{
      real1=z;
  }

  r=Math.sqrt(parseFloat(real1)*parseFloat(real1)+parseFloat(img1)*parseFloat(img1));

  theta=Math.atan2(parseFloat(img1),parseFloat(real1));
  //atan2 retorna o angulo no quadrante correto.

  real=(Math.log(r)).toString();
  img=(theta).toString();   

  if ((img1==0)&&(real1>0))
  {
     img="0";
  } 

  if (img!="0") {
     return real+' i'+img;
  }
  else
  {	  
     return real; 
  }
}


function SQRT(z)
{
  return POWER(z,"0.5");
}



function POWER(z1,z2)
{
//returns z1^z2
return EXP(TWOIMPUTS("*",z2,LOG(z1)));	
}



function TWOIMPUTS(kind,z1,z2)
{
//z1 and z2 are strings representing complex numbers.
//If kind="+" it returns addition, etc

    x1=0;
    x2=0;
    img1="0";
    img2="0";
    x1=z1.indexOf("i");
    if (x1!=-1) {
      real1=z1.substr(0, x1-1);
      img1=z1.substr(x1+1,z1.length);
    }
    else
      real1=z1;

    x2=z2.indexOf("i"); 
    if (x2!=-1) {
       real2=z2.substr(0, x2-1);
       img2=z2.substr(x2+1,z2.length);
    }
    else
      real2=z2;

    if (kind=="+"){ //adition
       real=(parseFloat(real1)+parseFloat(real2)).toString();
       img=(parseFloat(img1)+parseFloat(img2)).toString();
    }
    if (kind=="-"){ //subtraction
       real=(parseFloat(real2)-parseFloat(real1)).toString();
       img=(parseFloat(img2)-parseFloat(img1)).toString();
    }

    if (kind=="*"){ //complex multiplication
       real=(parseFloat(real1)*parseFloat(real2)-parseFloat(img1)*parseFloat(img2)).toString();
       img=(parseFloat(real1)*parseFloat(img2)+parseFloat(real2)*parseFloat(img1)).toString();
    } 

    if ((kind=="*") && (img1=="0") && (img2=="0")){ //real multiplication
       real=(parseFloat(real1)*parseFloat(real2)).toString();
       img="0"; 
    }
    if (kind=="/"){ //division
       divi=parseFloat(real1)*parseFloat(real1)+parseFloat(img1)*parseFloat(img1); 
       real=((parseFloat(real2)*parseFloat(real1)+parseFloat(img1)*parseFloat(img2))/divi).toString();
       img=((parseFloat(real1)*parseFloat(img2)-parseFloat(real2)*parseFloat(img1))/divi).toString();
    }

   

    if (real.length>15)
    {
      temp=parseFloat(real).toPrecision(16);
      real=temp.toString();
    }
   

   //This is to eliminate "zeros at right".
    Temp= real.length;
    for (i = 0; i < Temp; i++) {
       real.trim();
       if((real.charAt(real.length-1)=="0") && (real.length>1)) {     
	   real=real.slice(0,real.length-1); 
       }
    }
    


    if (img!="0"){
       return real+" i"+img;
    }
    else
       return real; 
    
}



function INV(z)
{
  return TWOIMPUTS("/", z,"1");	
}

function NEG(z)
{
  return TWOIMPUTS("*",z,"-1");	
}

///////////////////////////////
//Other functions
///////////////////////////


function gamma(z)
{
 
 var c= new Array;
 //This implements the Spouge's approximation for gamma function with a=12.

 zz=TWOIMPUTS("-","1",z);

 //calculation of the parameters
 c[0]=Math.sqrt(2*Math.acos(-1)).toString();
 

 for (k = 1; k < 12; k++)
 {
    c[k]=(Math.pow(-1,k-1)*Math.pow(-k+12,k-0.5)*Math.exp(-k+12)/fact(k-1)).toString();
 }

 //calculation of the summation
 summ=c[0];

 for (k = 1; k < 12; k++)
 {  
    temp=TWOIMPUTS("/",TWOIMPUTS("+",zz,k.toString()),c[k]);	 
    summ=TWOIMPUTS("+",summ,temp);
 }


 //final calculation
 
  result=POWER(TWOIMPUTS("+",zz,"12"),TWOIMPUTS("+",zz,"0.5"));
 result=TWOIMPUTS("*",result,summ);
 result=TWOIMPUTS("*",result,EXP(TWOIMPUTS("-","12",NEG(zz))));
 return result; 
}   



function zoom1() {
	    Zoom=Zoom-10;
            document.body.style.zoom = Zoom.toString()+"%";
        }
function zoom2() {
	     Zoom=Zoom+10;
            document.body.style.zoom = Zoom.toString()+"%"; 
        }

function LitleHelp()
{ //Things that repeat a lot.
    novo=true;
    edicao=false;
    Eativo=false;
}
function R2C()
{
   linhas.linha1.value=linhas.linha2.value+" i"+linhas.linha1.value;
   linhas.linha2.value=linhas.linha3.value;
   linhas.linha3.value=linhas.linha4.value;
   linhas.linha4.value=linhas.linha5.value;
   linhas.linha5.value="";
   edicao=false;  
}
function C2R()
{
    img="0";
    x=linhas.linha1.value.indexOf("i");
    real=linhas.linha1.value.substr(0, x-1);
    if (x!=-1) //raios!
    {
      enterenter();	    
      img=linhas.linha1.value.substr(x+1,linhas.linha1.length);
      linhas.linha2.value=real;
      linhas.linha1.value=img;
    }
    
    edicao=false; 
}

function fact(n)
{
	if (n==1||n==0) 
	   {
		   return 1;
	   }
	else
	   {
		   return n*fact(n-1);
	   }
}

function MFact()
{
    linhas.linha1.value=(fact(parseInt(linhas.linha1.value))).toString();
    novo=true;
    edicao=false;
    Eativo=false;
}	


function MRoot()
{
    linhas.linha1.value=POWER(linhas.linha2.value,INV(linhas.linha1.value));
    linhas.linha2.value=linhas.linha3.value;
    linhas.linha3.value=linhas.linha4.value;
    linhas.linha4.value=linhas.linha5.value;
    linhas.linha5.value="";
    LitleHelp();
}  

function MPow()
{
    x1=linhas.linha1.value.indexOf("i");
    x2=linhas.linha2.value.indexOf("i");
    if ((x1==-1)&&(x2==-1)){ 
	 linhas.linha1.value=(Math.pow(parseFloat(linhas.linha2.value),parseFloat(linhas.linha1.value))).toString();
	 //This non-complex version is to avoid stupid things like 5^2=24.999999999999996.

    }
    else
         linhas.linha1.value=POWER(linhas.linha2.value,linhas.linha1.value);

    linhas.linha2.value=linhas.linha3.value;
    linhas.linha3.value=linhas.linha4.value;
    linhas.linha4.value=linhas.linha5.value;
    linhas.linha5.value="";
    LitleHelp();
}  

function MSqrt()
{
    linhas.linha1.value=SQRT(linhas.linha1.value);
    LitleHelp();
}  

function MLog()
{
    linhas.linha1.value=LOG(linhas.linha1.value);
    LitleHelp();
}  
function MExp()
{
    linhas.linha1.value=EXP(linhas.linha1.value);
    LitleHelp();
}  

function MSin()
{   
    z=linhas.linha1.value;
    x1=z.indexOf("i");
    if(x1!=-1)
    {  //sin(x)=(exp(ix)-exp(-ix))/2i 
       temp1=EXP(TWOIMPUTS("*",z,"0 i1"));    //exp(iz)
       temp2=EXP(TWOIMPUTS("*",z,"0 i-1"));   //exp(-iz)
       linhas.linha1.value=TWOIMPUTS("/","0 i2",TWOIMPUTS("-",temp2,temp1));
    }
    else
    {
       linhas.linha1.value=(Math.sin(parseFloat(z))).toString();
    }
    LitleHelp();
}  
function MCos()
{ 
    z=linhas.linha1.value;
    x1=z.indexOf("i");
    if(x1!=-1)
    {  //cos(x)=(exp(ix)+exp(-ix))/2 
       temp1=EXP(TWOIMPUTS("*",z,"0 i1"));    //exp(iz)
       temp2=EXP(TWOIMPUTS("*",z,"0 i-1"));   //exp(-iz)
       linhas.linha1.value=TWOIMPUTS("/","2",TWOIMPUTS("+",temp2,temp1));
    }
    else
    {
       linhas.linha1.value=(Math.cos(parseFloat(z))).toString();
    }
    LitleHelp();
}  
function MTan()
{   z=linhas.linha1.value;
    x1=z.indexOf("i");
    if(x1!=-1)
    { 	
       //tan(x)=sin(x)/cos(x)
       temp1=EXP(TWOIMPUTS("*",z,"0 i1"));    //exp(iz)
       temp2=EXP(TWOIMPUTS("*",z,"0 i-1"));   //exp(-iz)
       TSin=TWOIMPUTS("/","0 i2",TWOIMPUTS("-",temp2,temp1)); //sin(z)
       TCos=TWOIMPUTS("/","2",TWOIMPUTS("+",temp2,temp1));    //cos(z)
       linhas.linha1.value=TWOIMPUTS("/",TCos,TSin);
    }
    else
    {
       linhas.linha1.value=(Math.tan(parseFloat(z))).toString();
    }	    
    LitleHelp();
}  

function MaSin()
{   //arcsin(x)=-i*ln[ix+sqrt(1-x^2)] 
    z=linhas.linha1.value;
    temp=TWOIMPUTS("*","0 i-1",LOG(TWOIMPUTS("+",SQRT(TWOIMPUTS("-",POWER(z,"2"),"1")),TWOIMPUTS("*","0 i1",z))));  
    if(z=="0"){temp="0"}
    x1=z.indexOf("i");
    if(x1==-1)
    {
      x2=parseFloat(z);
      if (-1<x2&&x2<1) 
      {  
	  temp=Math.asin(x2).toString(); //non complex
      }
    }	    
    linhas.linha1.value=temp;
    LitleHelp();
}  
function MaCos()
{   //arccos(x)=pi/2-arcsin(x)   
    z=linhas.linha1.value;

    temp=TWOIMPUTS("*","0 i-1",LOG(TWOIMPUTS("+",SQRT(TWOIMPUTS("-",POWER(z,"2"),"1")),TWOIMPUTS("*","0 i1",z)))); 
    temp2=TWOIMPUTS("-",temp,"1.5707963267949");
    if(z=="1"){temp2="0"}
    x1=z.indexOf("i");
    if(x1==-1)
    {
      x2=parseFloat(z);
      if (-1<x2&&x2<1) 
      {  
	  temp2=Math.acos(x2).toString(); //non complex
      }
    }	    

    linhas.linha1.value=temp2;
    LitleHelp();
}  
function MaTan()
{   //arctan(x)=(i/2)*[ln(1-ix)-ln(1+ix)] 
    z=linhas.linha1.value;
    temp=TWOIMPUTS("*","0 i1",z);
    temp2=LOG(TWOIMPUTS("-",temp,"1"));  
    temp3=LOG(TWOIMPUTS("+",temp,"1"));
    temp4=TWOIMPUTS("-",temp3,temp2);
    temp5=TWOIMPUTS("*","0 i0.5",temp4);
    x1=z.indexOf("i");
    if(x1==-1)
    {
      x2=parseFloat(z); 
      temp5=Math.atan(x2).toString(); //non complex
    }	    
    linhas.linha1.value=temp5;
    LitleHelp();
}  

function MSinh()
{
    z=linhas.linha1.value;
    temp=TWOIMPUTS("/","2",TWOIMPUTS("-",EXP(NEG(z)),EXP(z)));
    linhas.linha1.value=temp;
    LitleHelp();
}  
function MCosh()
{
    z=linhas.linha1.value;
    temp=TWOIMPUTS("/","2",TWOIMPUTS("+",EXP(NEG(z)),EXP(z)));
    linhas.linha1.value=temp;
    LitleHelp();
}  
function MTanh()
{
    z=linhas.linha1.value;
    temp1=TWOIMPUTS("-",EXP(NEG(z)),EXP(z));
    temp2=TWOIMPUTS("+",EXP(NEG(z)),EXP(z));
    temp=TWOIMPUTS("/",temp2,temp1);
    linhas.linha1.value=temp;
    LitleHelp();
}  

function MaSinh()
{
    //arcsinh(z)=ln(z+sqrt(z^2+1)). 
    z=linhas.linha1.value;
    temp=LOG(TWOIMPUTS("+",SQRT(TWOIMPUTS("+",POWER(z,"2"),"1")),z));  
    linhas.linha1.value=temp;
    LitleHelp();
}  
function MaCosh()
{
    //arccosh(z)=ln[z+sqrt(z+1)*sqrt(z-1)]. 
    z=linhas.linha1.value;
    zpone=TWOIMPUTS("+","1",z); //z+1
    zmone=TWOIMPUTS("-","1",z); //z-1
    temp=LOG(TWOIMPUTS("+",TWOIMPUTS("*",SQRT(zmone),SQRT(zpone)),z));    
    linhas.linha1.value=temp; 
    LitleHelp();
}  
function MaTanh()
{
    //arctanh(z)=0.5*ln[(1+z)/(1-z)] 
    z=linhas.linha1.value;
    temp=LOG(TWOIMPUTS("/",TWOIMPUTS("-",z,"1"),TWOIMPUTS("+",z,"1")));
    temp=TWOIMPUTS("/","2",temp);
    linhas.linha1.value=temp;
    LitleHelp();
} 

function sto()
{
    Memory=linhas.linha1.value;
}  

function rcl()
{
    enterenter();
    linhas.linha1.value=Memory;
}  

function MPi()
{
    EntraNumeral((Math.PI).toString());
    LitleHelp();
}  

function MPiSCO()
{
    EntraNumeral((Math.PI/180).toString());
    LitleHelp();
}	

function pm()
{
   if (Eativo==false)
   {	
    linhas.linha1.value=NEG(linhas.linha1.value);
   }
   else
   {
    linhas.linha1.value=linhas.linha1.value+"-";
    Eativo=false;
   }
}  
  

function xy()
{
    temp=linhas.linha2.value;
    linhas.linha2.value=linhas.linha1.value;
    linhas.linha1.value=temp;
    Eativo=false;
}  

//Script created by Jose Lauro Strapasson.
 
function mais(){TwoImputs("+")}; 
function menos(){TwoImputs("-")}; 
function vezes(){TwoImputs("*")}; 
function dividido(){TwoImputs("/")};


function TwoImputs(kind)
{
    z1=linhas.linha1.value;
    z2=linhas.linha2.value;

    linhas.linha1.value=TWOIMPUTS(kind,z1,z2);
    linhas.linha2.value=linhas.linha3.value;
    linhas.linha3.value=linhas.linha4.value;
    linhas.linha4.value=linhas.linha5.value;
    linhas.linha5.value="";
    LitleHelp();
}
	

function inverso()
{
    linhas.linha1.value=INV(linhas.linha1.value)
    LitleHelp();
}

function GAMMA()
{
    linhas.linha1.value=gamma(linhas.linha1.value);
    LitleHelp();
}

function doc()
{
    linhas.linha1.value="";
    Eativo=false;
}

function cla()
{
    linhas.linha5.value="";
    linhas.linha4.value="";
    linhas.linha3.value="";
    linhas.linha2.value="";
    doc();
}

function enterenter()
{
    linhas.linha5.value=linhas.linha4.value;
    linhas.linha4.value=linhas.linha3.value;
    linhas.linha3.value=linhas.linha2.value;
    linhas.linha2.value=linhas.linha1.value;
    edicao=true;
    novo=true;
    Eativo=false;
}
  

function EntraNumeral(Numeral)
{
  if(edicao==true)
  {
    if(novo==false)
     {
      linhas.linha1.value=linhas.linha1.value + Numeral;
      }
    else
     {
       linhas.linha1.value=Numeral;
       novo=false;
     }
  }
  else
   {
     linhas.linha5.value=linhas.linha4.value;
     linhas.linha4.value=linhas.linha3.value;
     linhas.linha3.value=linhas.linha2.value;
     linhas.linha2.value=linhas.linha1.value;
     linhas.linha1.value=Numeral;
     edicao=true;
     novo=false;
     Eativo=false;
  }
}         

function enterponto(){ EntraNumeral('.'); }
function ME(){ 
    if (Eativo==false)
    {	    
	EntraNumeral('e');
	Eativo=true;
    }
}
function enter0(){ EntraNumeral('0');}
function enter1(){ EntraNumeral('1');}
function enter2(){ EntraNumeral('2');}
function enter3(){ EntraNumeral('3');}
function enter4(){ EntraNumeral('4');}
function enter5(){ EntraNumeral('5');}
function enter6(){ EntraNumeral('6');}
function enter7(){ EntraNumeral('7');}
function enter8(){ EntraNumeral('8');}
function enter9(){ EntraNumeral('9');}

</script></head>
<body style="color: rgb(0, 0, 0); background-color: blue;" alink="#000099" link="#000099" vlink="#990099">(JavaScript) Scientific Complex RPN Calculator
<form id="linhas">
<input name="linha5" type="text"  style="width:309px"><br>
<input name="linha4" type="text"  style="width:309px"><br>
<input name="linha3" type="text"  style="width:309px"><br>
<input name="linha2" type="text"  style="width:309px"><br>
<input name="linha1" type="text"  style="width:309px">
</form>

<input onclick="zoom1()" value="zoom-" type="button" class="btnStyle2">
<input onclick="zoom2()" value="zoom+" type="button" class="btnStyle2">
<input onclick="sto()" value="STO" type="button" class="btnStyle1">
<input onclick="rcl()" value="RCL" type="button" class="btnStyle1">
<input onclick="cla()" value="CLA" type="button" class="btnStyle1">

<br>
<input onclick="enter7()" value="7" type="button" class="btnStyle1">
<input onclick="enter8()" value="8" type="button" class="btnStyle1">
<input onclick="enter9()" value="9" type="button" class="btnStyle1">
<input onclick="dividido()" value="÷" type="button" class="btnStyle1">
<input onclick="xy()" value="x&lt;&gt;y" type="button" class="btnStyle1">
<br>
<input onclick="enter4()" value="4" type="button" class="btnStyle1">
<input onclick="enter5()" value="5" type="button" class="btnStyle1">
<input onclick="enter6()" value="6" type="button" class="btnStyle1">
<input onclick="vezes()" value="*" type="button" class="btnStyle1">
<input onclick="inverso()" value="1/x" type="button" class="btnStyle1">
<br>
<input onclick="enter1()" value="1" type="button" class="btnStyle1">
<input onclick="enter2()" value="2" type="button" class="btnStyle1">
<input onclick="enter3()" value="3" type="button" class="btnStyle1">
<input onclick="menos()" value="-" type="button" class="btnStyle1">
<input onclick="pm()" value="&#177;" type="button" class="btnStyle1">
<br>
<input onclick="enter0()" value="0" type="button" class="btnStyle1">
<input onclick="enterponto()" value="." type="button" class="btnStyle1">
<input onclick="doc()" value="C" type="button" class="btnStyle1">
<input onclick="mais()" value="+" type="button" class="btnStyle1">
<input onclick="ME()" value="E" type="button" class="btnStyle1">
<br>
<input onclick="MSin()" value="sin" type="button" class="btnStyle1">
<input onclick="MCos()" value="cos" type="button" class="btnStyle1">
<input onclick="MTan()" value="tan" type="button" class="btnStyle1">
<input onclick="enterenter()" value="ENTER" type="button" class="btnStyle3">
<br>
<input onclick="MaSin()" value="asin" type="button" class="btnStyle1">
<input onclick="MaCos()" value="acos" type="button" class="btnStyle1">
<input onclick="MaTan()" value="atan" type="button" class="btnStyle1">
<input onclick="MLog()" value="ln" type="button" class="btnStyle1">
<input onclick="MExp()" value="exp" type="button" class="btnStyle1">
<br>
<input onclick="MSinh()" value="sinh" type="button" class="btnStyle1">
<input onclick="MCosh()" value="cosh" type="button" class="btnStyle1">
<input onclick="MTanh()" value="tanh" type="button" class="btnStyle1">
<input onclick="MSqrt()" value="&#8730;" type="button" class="btnStyle1">
<input onclick="MPow()" value="y^x" type="button" class="btnStyle1">
<br>
<input onclick="MaSinh()" value="asinh" type="button" class="btnStyle1">
<input onclick="MaCosh()" value="acosh" type="button" class="btnStyle1">
<input onclick="MaTanh()" value="atanh" type="button" class="btnStyle1">
<input onclick="MPi()" value="&pi;" type="button" class="btnStyle1">
<input onclick="MRoot()" value="x&#8730;y" type="button" class="btnStyle1">
<br>
<input onclick="R2C()" value="R2C" type="button" class="btnStyle1">
<input onclick="C2R()" value="C2R" type="button" class="btnStyle1">
<input onclick="MPiSCO()" value="&pi;/180" type="button" class="btnStyle1">
<input onclick="GAMMA()" value="&Gamma;" type="button" class="btnStyle1">
<input onclick="MFact()" value="!" type="button" class="btnStyle1">
</body></html>
